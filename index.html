<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1">

    <title>Frostbite</title>
    <link rel="stylesheet" href="Styling/MainStyle.css" type="text/css"/>
    <script src="Scripts/ScrollFade.js"></script>
    <title></title>
</head>
<body>

<!---------------------------------------------------------------- ADMIN MENU -------------------------------------------------------------------------------------------->

<div id="adminContainer">

    <h3 id="adminTitle">Admin menu</h3>

    <div class="alignInMiddle">
        <button id="changeOutlineColour">Change Outline Colour</button>
    </div>

    <div class="alignInMiddle">
        <button id="toggleBannerText">Overlay: ON</button>
    </div>

    <div class="alignInMiddle">
        <button id="changeBackgroundImage">Change Banner</button>
        <button id="backgroundToolTip">Recommended size is 1920x480</button>
    </div>

    <div class="alignInMiddle">
        <button id="changeText">Change Story</button>
    </div>

    <div class="alignInMiddle">
        <button id= "addAlbumCover"> Add Album Cover</button>
    </div>

    <div class="alignInMiddle">
        <button id="changeYouTubeURL">Change YT Video</button>
    </div>



    <div class="alignInMiddle">
    <button id="logOutButton">Log Out</button>
    </div>

</div>

<!------------------------------------------------------------------- NAVBAR --------------------------------------------------------------------------------------------->

<div class="navigation-bar">
    <a id="logoFloat" href="index.html" class="navMenuSelectable"><img src="Pictures/frostbiteLogo.jpg" id="logo" draggable="false" alt="logo"></a>
    <h3><a id="logoText" href="index.html"> FROSTBITE </a></h3>

    <div id="backgroundSquare"></div>

    <a href="https://www.youtube.com/channel/UCmt3wU22pVtUPqhoHVcOQ-g/featured" class="navMenuSelectable"><img  id="youtubeLogo" src="Pictures/YoutubeInverted.png" draggable="false" alt="YouTube"></a>
    <a href="https://www.instagram.com/frostbite.band/" class="navMenuSelectable"><img  id="instagramLogo" src="Pictures/InstagramInverted.png" draggable="false" alt="Instagram"></a>
    <a href="https://www.facebook.com/band.frostbite" class="navMenuSelectable"><img id="facebookLogo" src="Pictures/FacebookInverted.png" draggable="false" alt="FaceBook"></a>

    <a href="#tickets" style="margin-right: 1vw;" class="navMenuSelectable">TICKETS</a>
    <a href="#youtubePreviewContainer" class="navMenuSelectable">VIDEO</a>
    <a href="#albumCovers" class="navMenuSelectable">ALBUMS</a>
    <a href="#aboutTitle" class="navMenuSelectable">ABOUT</a>

</div>

<!--------------------------------------------------------------- LOGIN POP-UP ----------------------------------------------------------------------------------------->

<div id="popUpLogin">

    <h3 id="signInText"> Sign in: </h3>

    <div id="emailContainer">
    <label id="loginEmailText" for="loginEmail">Email:</label>
    <input type="text" id="loginEmail" name="loginEmail"><br><br>
    </div>

    <div id="passwordContainer">
    <label id="loginPasswordText" for="loginPassword">Password:</label>
    <input type="password" id="loginPassword" name="loginPassword"><br><br>
    </div>

    <div class="alignInMiddle">
        <button id="cancelSignInButton">Cancel</button>
        <button id="acceptSignInButton">Continue</button>
    </div>

</div>

<!--------------------------------------------------------- ADMIN-EDIT (VALUE) POP-UP ------------------------------------------------------------------------------------------->

<div id="popUpAdminValue">

    <div class="alignInMiddle">
    <h3 id="popUpAdminValueText">Enter the new YouTube URL-ID (the letters after 'watch?v=')</h3>

    <div id="newValueContainer">
        <label id="newValueContainerLabel" for="newValueContainerValue"></label>
        <input type="text" id="newValueContainerValue" name="newValueContainerValue"><br><br>
    </div>

        <button id="cancelNewValueButton">Cancel</button>
        <button id="acceptNewValueButton">Accept</button>

</div>

</div>

<!---------------------------------------------------------------- INFO POP-UP ------------------------------------------------------------------------------------------->

<div id="popUpInfo">
    <div class="alignInMiddle">
        <h3 id="popUpInfoText"></h3>
    </div>
</div>

<!--------------------------------------------------------------- MAIN CONTAINER ----------------------------------------------------------------------------------------->

<div id="mainContent" style="display: block">

    <div id="banner">
        <img id="frostbiteBackground" src="Pictures/bannerPlaceholder.png" height=100% width=100% draggable="false" alt="Frostbite Background" class="largePictureDisplay"/>

        <div id="bannerText">
            <h3 id="frostbiteBannerNameBackground">FROSTBITE</h3>
            <h3 id="frostbiteBannerName">FROSTBITE</h3>
        </div>
    </div>

    <div id="aboutContainer">
        <div class="item scrollFade">
        <h3 id="aboutTitle">FROSTBITE: The Story</h3>

            <a id="aboutText"></a>
            <a id="aboutTextEnd" style="margin-top: 0.6vw; margin-bottom: 2vw">For more information please get in touch.</a>
        </div>
    </div>

    <div id="albumCovers">
        <div class="item scrollFade">

          <h3 id="ourAlbums"> Albums </h3>

             <div id="gridContainer">
               <div class="coverGridItem">
                <img class="albumImage" src="Pictures/testCover.png" alt="testCover"/>
               </div>
                <div class="coverGridItem">
                    <img class="albumImage" src="Pictures/testCover2.png" alt="testCover2"/>
                </div>
             </div>

        </div>
    </div>

    <div id="youtubePreviewContainer">
        <div class="item scrollFade">

            <h3 id="youtubePreviewTitle"> Video </h3>

            <div class="alignInMiddle">
            <iframe id="youtubePreviewVideo" src="https://www.youtube.com/embed/rykIs0XlA8Q" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>

        </div>
    </div>

    <!--<div id="spotifyEmbed"></div>
        <iframe style="border-radius:0.5vw" src="https://open.spotify.com/embed/artist/0rIROc9qyjwndVoDFa2WD0?utm_source=generator" width="25%" height="400" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
    </div>-->

    <div id="tickets">
        <div class="item scrollFade">

            <h3 id="ticket_title"> Tickets </h3>

            <div class="alignInMiddle">
                <h2 id="ticket_placeholder">Stay Tuned (Coming Soon)</h2>
            </div>

        </div>
    </div>

    <div id="socialsContainer">
        <div class="item scrollFade">
            <div class="alignInMiddle">

            <h3 id="socialsTitle"> Listen On </h3>

                <div id="socialsSquareYoutube"></div>
                <div id="socialsSquareSpotify"></div>

                <a href="https://www.youtube.com/channel/UCmt3wU22pVtUPqhoHVcOQ-g"><img src="Pictures/socialsYoutubeImage.png" id="socialsYoutube" alt="YouTube" draggable="false"></a>
                <a href="https://open.spotify.com/artist/0rIROc9qyjwndVoDFa2WD0"><img src="Pictures/socialsSpotifyImage.png" id="socialsSpotify" alt="Spotify" draggable="false"></a>

            </div>
        </div>
    </div>

</div>

    <!--------------------------------------------------------------- FOOTER --------------------------------------------------------------------------------------------->

<div class="item scrollFade">
    <footer id="footer">
        <h3 class="footerText">© Copyright 2022 Frostbite. All rights reserved.</h3>
        <h3 class="footerText"><a id="emailLink" href="mailto:frostbite.band@hotmail.com">post@frostbiteband.com</a></h3>
        <div id="adminLogin"><h3 class="footerText">admin login</h3></div>
    </footer>
</div>

<script type="module">

    //<----------------------------------------------------- DATABASE CONFIGURATION ------------------------------------------------------------------------------------->

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-database.js";
    import { createUserWithEmailAndPassword, getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut} from 'https://www.gstatic.com/firebasejs/9.6.6/firebase-auth.js';
    import { getStorage, ref as refStorage, uploadBytes, getDownloadURL} from 'https://www.gstatic.com/firebasejs/9.6.6/firebase-storage.js';

    const firebaseConfig = {
        apiKey: "AIzaSyDdmHsJu_s8rE1dkcB3oLyyTLJQOI1ZVAg",
        authDomain: "frostbite-backend.firebaseapp.com",
        projectId: "frostbite-backend",
        storageBucket: "frostbite-backend.appspot.com",
        messagingSenderId: "388567472682",
        appId: "1:388567472682:web:893bbf2a74fe78bc4e8153",
        measurementId: "G-CMP5CEZ81E",
        databaseURL: "https://frostbite-backend-default-rtdb.europe-west1.firebasedatabase.app"
    };

    // Initialize Firebase
    const firebase = initializeApp(firebaseConfig);
    const db = getDatabase();
    const storage = getStorage();

    const popUpInfoWindow = document.getElementById("popUpInfo");
    const popUpWindowText = document.getElementById("popUpInfoText");

    //<--------------------------------------------------------- ONLOAD FUNCTIONS ---------------------------------------------------------------------------------------->

    document.body.onload = function() {getInfoFromServer()};
    function getInfoFromServer(){
        getBannerImage();
        setOutlineColour();
        getBannerTextStatus();
        getTitleText();
        getUserStatus();
        getYouTubeVideoURL();
        getAlbums();
    }

    function getBannerImage(){
        getDownloadURL(refStorage(storage, 'bannerImage'))
            .then((url) => {
                document.getElementById("frostbiteBackground").src = url;
            })
    }

    //gets one album cover from firebase
    function getAlbums() {
        let totalAlbumsToLoad = 0;
        let currentLoadingAlbum = 0;

        const howManyAlbums = ref(db, 'howManyAlbums');
        onValue(howManyAlbums, (snapshot) => {
            totalAlbumsToLoad = snapshot.val();

        });

        while (totalAlbumsToLoad >= currentLoadingAlbum) {

            getDownloadURL(refStorage(storage, 'AlbumCovers/Album' + currentLoadingAlbum + '.png'))
                .then((url) => {
                    const divElement = document.createElement("div");
                    const addAlbum = document.createElement("img");

                    addAlbum.src = url;
                    addAlbum.className = "albumImage";

                    divElement.appendChild(addAlbum);
                    divElement.className = "coverGridItem";

                    document.getElementById("gridContainer").appendChild(divElement);
                })
            currentLoadingAlbum++;
        }
    }

    function getBannerTextStatus(){
        const bannerTextStatus = ref(db, 'toggleBannerStatus/status');
        onValue(bannerTextStatus, (snapshot) => {

            let toggleStatus = snapshot.val();
            let bannerText = document.getElementById("bannerText");
            let aboutTitle = document.getElementById("aboutTitle");
            let toggleButton = document.getElementById("toggleBannerText");

            if (toggleStatus === "ON"){
                bannerText.style.display = "block";
                aboutTitle.style.marginTop = "-1.5vw"
                toggleButton.innerHTML = "Overlay: ON"
            } else {
                bannerText.style.display = "none";
                aboutTitle.style.marginTop = "0.9vw"
                toggleButton.innerHTML = "Overlay: OFF"
            }
        });
    }

    //Gets the frostbite text from the server on load
    function getTitleText(){
        const userStatus = ref(db, 'titleText/titleTextContent');
        onValue(userStatus, (snapshot) => {
            document.getElementById("aboutText").innerHTML = snapshot.val();
        });
    }

    function getYouTubeVideoURL(){
        const userStatus = ref(db, 'youtubeURL/youtubeURLContent');
        onValue(userStatus, (snapshot) => {
            document.getElementById("youtubePreviewVideo").src = "https://www.youtube.com/embed/" + snapshot.val();
        });
    }

    //gets the user status (logged in/logged out) and displays the admin menu accordingly
    function getUserStatus(){
        const auth = getAuth();
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById("adminContainer").style.display = "block";
                document.getElementById("adminLogin").style.display = "none";
            } else {
                document.getElementById("adminContainer").style.display = "none";
            }
        });
    }

    function setOutlineColour(){
        const newOutlineColour = ref(db, 'outlineColour/HexCode');
        onValue(newOutlineColour, (snapshot) => {
            const bodyElement = document.getElementsByTagName("BODY")[0];
            bodyElement.style.setProperty('--outlineColor', snapshot.val());
        });
    }

    //<--------------------------------------------------------- ADMIN FUNCTIONS ---------------------------------------------------------------------------------------->

    document.getElementById("changeOutlineColour").onclick = function(){changeOutlineColour();}
    function changeOutlineColour(){

        showPopUpAdminValueWindow("Enter the new HEX colour code (example: #a14a95)")
        document.getElementById("acceptNewValueButton").onclick = function(){confirmColourChange();}

    }

    function confirmColourChange(){
        let newOutlineColour = document.getElementById("newValueContainerValue").value;

        const reg = /^#([0-9a-f]{3}){1,2}$/i;
        const isValidHex = reg.test(newOutlineColour);

        if(isValidHex === true) {
            if (newOutlineColour === "") {
                enablePopUpWindow("Field cannot be empty!");
            } else {
                set(ref(db, 'outlineColour'), {
                    HexCode: newOutlineColour,
                });
                enablePopUpWindow("Colour updated!");
                closeNewValueContainerWindow();
                resetNewAdminValue();
            }
        } else {
            enablePopUpWindow("Not a valid HEX colour!");
        }
    }

    document.getElementById("changeBackgroundImage").onclick = function(e){changeBackgroundImage();}
    function changeBackgroundImage(){

        let files = [];
        let reader;

        const input = document.createElement('input');
        input.type = 'file';
        input.accept = "image/png, image/jpg, image/jpeg, image/gif";

            input.onchange = e => {
                files = e.target.files;
                reader = new FileReader();
                reader.onload = function () {

                    const storage = getStorage();
                    const imagesRef = refStorage(storage, 'bannerImage');

                    //uploads the new image to firebase
                    uploadBytes(imagesRef, files[0]).then((snapshot) => {

                        //gets the new image from firebase and updates the banner
                        getDownloadURL(refStorage(storage, 'bannerImage'))
                            .then((url) => {
                                document.getElementById("frostbiteBackground").src = url;
                            })

                    });
                }
                reader.readAsDataURL((files[0]));
            }
            input.click();
    }

    document.getElementById("toggleBannerText").onclick = function(){toggleBannerTitle();}
    function toggleBannerTitle(){
        let status = document.getElementById("toggleBannerText").innerHTML;

        if (status === "Overlay: ON"){
            set(ref(db, 'toggleBannerStatus'), {
                status: "OFF",
            });
            document.getElementById("toggleBannerText").innerHTML = "Overlay: OFF"

        } else {
            set(ref(db, 'toggleBannerStatus'), {
                status: "ON",
            });
            document.getElementById("toggleBannerText").innerHTML = "Overlay: ON"
        }

    }

    document.getElementById("changeText").onclick = function(){changeText();}
    function changeText() {

        showPopUpAdminValueWindow("Please copy & paste your new story text here")
        document.getElementById("acceptNewValueButton").onclick = function(){confirmChangeText();}

    }

    function confirmChangeText(){
        let newText = document.getElementById("newValueContainerValue").value;
        if (newText === "") {
            enablePopUpWindow("Field cannot be empty!");
        } else {
            set(ref(db, 'titleText'), {
                titleTextContent: newText,
            });
            enablePopUpWindow("Story updated!");
            closeNewValueContainerWindow();
            resetNewAdminValue();
        }
    }

    document.getElementById("changeYouTubeURL").onclick = function(){changeYouTubeURL();}
    function changeYouTubeURL() {

        showPopUpAdminValueWindow("Enter the new YouTube URL-ID (the letters after 'watch?v=')")
        document.getElementById("acceptNewValueButton").onclick = function(){confirmYouTubeURL();}

    }

    function confirmYouTubeURL(){
        let newURL = document.getElementById("newValueContainerValue").value;
        if (newURL === "") {
            enablePopUpWindow("Field cannot be empty!");
        } else {
            set(ref(db, 'youtubeURL'), {
                youtubeURLContent: newURL,
            });
            enablePopUpWindow("Video updated!");
            closeNewValueContainerWindow();
            resetNewAdminValue();
        }
    }

    function enablePopUpWindow(text){
        popUpWindowText.innerHTML = text;

        document.body.removeChild(popUpInfoWindow);
        document.body.appendChild(popUpInfoWindow);
        popUpInfoWindow.style.animation = "dropDown 3.25s"
    }

    function showPopUpAdminValueWindow(descriptionOfFeature){
        let newValueContainer = document.getElementById("popUpAdminValue");
        newValueContainer.style.display = "block";

        let popUpAdminValueText = document.getElementById("popUpAdminValueText");
        popUpAdminValueText.innerHTML = descriptionOfFeature;
    }

    document.getElementById("cancelNewValueButton").onclick = function(){closeNewValueContainerWindow();}
    function closeNewValueContainerWindow(){
        document.getElementById("popUpAdminValue").style.display = "none";
        resetNewAdminValue();
    }

    function resetNewAdminValue(){
        document.getElementById("newValueContainerValue").value = "";
    }

    //<--------------------------------------------------------- LOGIN/LOGOUT ---------------------------------------------------------------------------------------->

    document.getElementById("acceptSignInButton").onclick = function(){getEmailAndPassword();}
    function getEmailAndPassword(){

        let email = document.getElementById("loginEmail").value;
        let password = document.getElementById("loginPassword").value;

        if (email === "" || password === ""){
            enablePopUpWindow("The fields cannot be empty!");

        } else {
            logIn(email, password);
        }
    }

    function logIn(email, password){

        const auth = getAuth();
        signInWithEmailAndPassword(auth, email, password)
            .then((userInfo) => {
                enablePopUpWindow("Successfully logged in");

                document.getElementById("adminContainer").style.display = "block";
                document.getElementById("adminLogin").style.display = "none";
                document.getElementById("popUpLogin").style.display = "none";

                document.getElementById("loginEmail").value = "";
                document.getElementById("loginPassword").value = "";
            })
            .catch((error) => {
                enablePopUpWindow("Wrong email/password!");
                document.getElementById("adminContainer").style.display = "none";
            });
    }

    document.getElementById("logOutButton").onclick = function(){logOut();}
    function logOut(){

        const auth = getAuth();
        signOut(auth).then(() => {
            enablePopUpWindow("Successfully logged out");
            document.getElementById("adminLogin").style.display = "block";
        }).catch((error) => {
            enablePopUpWindow(error);
        });
    }

    document.getElementById("cancelSignInButton").onclick = function(){cancelSignIn();}
    function cancelSignIn(){
        document.getElementById("popUpLogin").style.display = "none";
        document.getElementById("loginEmail").value = "";
        document.getElementById("loginPassword").value = "";
    }

    document.getElementById("adminLogin").onclick = function(){showSignInWindow();}
    function showSignInWindow(){
        document.getElementById("popUpLogin").style.display = "block";
    }

    //<--------------------------------------------------------------- TBA ------------------------------------------------------------------------------------------>

    /*const email = "admin@outlook.com"
    const password = "123Password123";

        function createUser() {
        console.log("User creation activated!");

        const auth = getAuth();
        createUserWithEmailAndPassword(auth, email, password)
            .then((userInfo) => {
                console.log("User created!")
            })
            .catch((error) => {
                const errorMessage = error.message;
                console.log(errorMessage);
            });
    }*/

/*
        function checkIfLoggedIn(){
            console.log("Checking for users")

            const auth = getAuth();
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    console.log("Update: You are logged in!");
                } else {
                    console.log("Update: You are not logged in!");
                }
            });
        }
    */

</script>

</body>
</html>