<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1">

    <title>Frostbite</title>
    <link rel="stylesheet" href="Styling/MainStyle.css" type="text/css" />
    <script src="Scripts/ScrollFade.js"></script>
    <title></title>
</head>
<body>

<!---------------------------------------------------------------- ADMIN MENU -------------------------------------------------------------------------------------------->

<div id="adminContainer">

    <h3 id="adminTitle">Admin menu</h3>

    <div class="alignInMiddle">
        <button id="changeOutlineColour">Change Outline Colour</button>
    </div>

    <div class="alignInMiddle">
        <button id="toggleBannerText">Overlay: ON</button>
    </div>

    <div class="alignInMiddle">
        <button id="changeBackgroundImage">Change Banner</button>
        <button id="backgroundToolTip">Recommended size is 1920x480</button>
    </div>

    <div class="alignInMiddle">
        <button id="changeText">Change Story</button>
    </div>

    <div class="alignInMiddle">
        <button id= "addAlbumCover"> Add Album Cover</button>
    </div>

    <div class="alignInMiddle">
        <button id="changeYouTubeURL">Change YT Video</button>
    </div>



    <div class="alignInMiddle">
    <button id="logOutButton">Log Out</button>
    </div>

</div>

<!------------------------------------------------------------------- NAVBAR --------------------------------------------------------------------------------------------->

<div class="navigation-bar">
    <a id="logoFloat" href="index.html" class="navMenuSelectable"><img src="Pictures/frostbiteLogo.jpg" id="logo" draggable="false" alt="logo"></a>
    <h3><a id="logoText" href="index.html"> FROSTBITE </a></h3>

    <div id="backgroundSquare"></div>

    <a href="https://www.youtube.com/channel/UCmt3wU22pVtUPqhoHVcOQ-g/featured" class="navMenuSelectable"><img  id="youtubeLogo" src="Pictures/YoutubeInverted.png" draggable="false" alt="YouTube"></a>
    <a href="https://www.instagram.com/frostbite.band/" class="navMenuSelectable"><img  id="instagramLogo" src="Pictures/InstagramInverted.png" draggable="false" alt="Instagram"></a>
    <a href="https://www.facebook.com/band.frostbite" class="navMenuSelectable"><img id="facebookLogo" src="Pictures/FacebookInverted.png" draggable="false" alt="FaceBook"></a>

    <a href="tickets.html" style="margin-right: 1vw;" class="navMenuSelectable">TICKETS</a>
    <a href="#youtubePreviewContainer" class="navMenuSelectable">VIDEO</a>
    <a href="#albumCovers" class="navMenuSelectable">ALBUMS</a>
    <a href="#aboutTitle" class="navMenuSelectable">ABOUT</a>
    <a href="index.html" class="navMenuSelectable">HOME</a>
</div>

<!--------------------------------------------------------------- MAIN CONTAINER ----------------------------------------------------------------------------------------->

<div id="mainContent" style="display: block">

    <div id="banner">
        <img id="frostbiteBackground" src="Pictures/bannerPlaceholder.png" height=100% width=100% draggable="false" alt="Frostbite Background" class="largePictureDisplay"/>

        <div id="bannerText">
            <h3 id="frostbiteBannerNameBackground">FROSTBITE</h3>
            <h3 id="frostbiteBannerName">FROSTBITE</h3>
        </div>
    </div>

    <div id="aboutContainer">
        <div class="item scrollFade">
        <h3 id="aboutTitle">FROSTBITE: The Story</h3>

            <a id="aboutText"></a>
            <a id="aboutTextEnd" style="margin-top: 0.6vw; margin-bottom: 2vw">For more information please get in touch.</a>
        </div>
    </div>

    <!-- I put the albums below the story, adding animation to the album images made the page lag a bit, so now they are out of sight when the page is loaded -->
    <div id="albumCovers">
        <div class="item scrollFade">

          <h3 id="ourAlbums">  Albums </h3>

             <div id="gridContainer">
               <div class="coverGridItem">
                <img id="testCover" src="Pictures/testCover.png" alt="testCover" height="100%" width="100%" />
               </div>
                <div class="coverGridItem">
                    <img id="testCover2" src="Pictures/testCover2.png" alt="testCover2" height="100%" width="100%" />
                </div>
             </div>

        </div>
    </div>

    <div id="youtubePreviewContainer">
        <div class="item scrollFade">

            <h3 id="youtubePreviewTitle"> Video </h3>

            <div class="alignInMiddle">
            <iframe id="youtubePreviewVideo" src="https://www.youtube.com/embed/rykIs0XlA8Q" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>

        </div>
    </div>

    <!--<div id="spotifyEmbed"></div>
        <iframe style="border-radius:0.5vw" src="https://open.spotify.com/embed/artist/0rIROc9qyjwndVoDFa2WD0?utm_source=generator" width="25%" height="400" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
    </div>-->

</div>
    <!--------------------------------------------------------------- FOOTER --------------------------------------------------------------------------------------------->

<div class="item scrollFade">
    <footer id="footer">
        <h3 class="footerText">© Copyright 2022 Frostbite. All rights reserved.</h3>
        <h3 class="footerText"><a id="emailLink" href="mailto:frostbite.band@hotmail.com">post@frostbiteband.com</a></h3>
        <div id="adminLogin"><h3 class="footerText">admin login</h3></div>
    </footer>
</div>

<script type="module">

    //<----------------------------------------------------- DATABASE CONFIGURATION ------------------------------------------------------------------------------------->

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-database.js";
    import { createUserWithEmailAndPassword, getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut} from 'https://www.gstatic.com/firebasejs/9.6.6/firebase-auth.js';
    import { getStorage, ref as refStorage, uploadBytes, getDownloadURL} from 'https://www.gstatic.com/firebasejs/9.6.6/firebase-storage.js';

    const firebaseConfig = {
        apiKey: "AIzaSyDdmHsJu_s8rE1dkcB3oLyyTLJQOI1ZVAg",
        authDomain: "frostbite-backend.firebaseapp.com",
        projectId: "frostbite-backend",
        storageBucket: "frostbite-backend.appspot.com",
        messagingSenderId: "388567472682",
        appId: "1:388567472682:web:893bbf2a74fe78bc4e8153",
        measurementId: "G-CMP5CEZ81E",
        databaseURL: "https://frostbite-backend-default-rtdb.europe-west1.firebasedatabase.app"
    };

    // Initialize Firebase
    const firebase = initializeApp(firebaseConfig);
    const db = getDatabase();
    const storage = getStorage();

    //<--------------------------------------------------------- ONLOAD FUNCTIONS ---------------------------------------------------------------------------------------->

    document.body.onload = function() {getInfoFromServer()};
    function getInfoFromServer(){
        getBannerImage();
        setOutlineColour();
        getBannerTextStatus();
        getTitleText();
        getUserStatus();
        getYouTubeVideoURL();
    }

    function getBannerImage(){
        getDownloadURL(refStorage(storage, 'bannerImage'))
            .then((url) => {
                document.getElementById("frostbiteBackground").src = url;
            })
    }

    function getBannerTextStatus(){
        const bannerTextStatus = ref(db, 'toggleBannerStatus/status');
        onValue(bannerTextStatus, (snapshot) => {

            let toggleStatus = snapshot.val();
            let bannerText = document.getElementById("bannerText");
            let aboutTitle = document.getElementById("aboutTitle");
            let toggleButton = document.getElementById("toggleBannerText");

            if (toggleStatus === "ON"){
                bannerText.style.display = "block";
                aboutTitle.style.marginTop = "-1.5vw"
                toggleButton.innerHTML = "Overlay: ON"
            } else {
                bannerText.style.display = "none";
                aboutTitle.style.marginTop = "0.9vw"
                toggleButton.innerHTML = "Overlay: OFF"
            }
        });
    }

    //Gets the frostbite text from the server on load
    function getTitleText(){
        const userStatus = ref(db, 'titleText/titleTextContent');
        onValue(userStatus, (snapshot) => {
            document.getElementById("aboutText").innerHTML = snapshot.val();
        });
    }

    function getYouTubeVideoURL(){
        const userStatus = ref(db, 'youtubeURL/youtubeURLContent');
        onValue(userStatus, (snapshot) => {
            document.getElementById("youtubePreviewVideo").src = "https://www.youtube.com/embed/" + snapshot.val();
        });
    }

    //gets the user status (logged in/logged out) and displays the admin menu accordingly
    function getUserStatus(){
        const auth = getAuth();
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById("adminContainer").style.display = "block";

            } else {
                document.getElementById("adminContainer").style.display = "none";
            }
        });
    }

    function setOutlineColour(){
        const newOutlineColour = ref(db, 'outlineColour/HexCode');
        onValue(newOutlineColour, (snapshot) => {
            const bodyElement = document.getElementsByTagName("BODY")[0];
            bodyElement.style.setProperty('--outlineColor', snapshot.val());
        });
    }

    //<--------------------------------------------------------- ADMIN FUNCTIONS ---------------------------------------------------------------------------------------->

    document.getElementById("changeOutlineColour").onclick = function(){changeOutlineColour();}
    function changeOutlineColour(){

        let newOutlineColour = prompt("Please enter the new HEX colour code (example: #a14a95)");

        if (newOutlineColour != null) {
            set(ref(db, 'outlineColour'), {
                HexCode: newOutlineColour,
            });
        }
    }

    document.getElementById("changeBackgroundImage").onclick = function(e){changeBackgroundImage();}
    function changeBackgroundImage(){

        let files = [];
        let reader;

        const input = document.createElement('input');
        input.type = 'file';
        input.accept = "image/png, image/jpg, image/jpeg, image/gif";

            input.onchange = e => {
                files = e.target.files;
                reader = new FileReader();
                reader.onload = function () {

                    const storage = getStorage();
                    const imagesRef = refStorage(storage, 'bannerImage');

                    //uploads the new image to firebase
                    uploadBytes(imagesRef, files[0]).then((snapshot) => {

                        //gets the new image from firebase and updates the banner
                        getDownloadURL(refStorage(storage, 'bannerImage'))
                            .then((url) => {
                                document.getElementById("frostbiteBackground").src = url;
                            })

                    });
                }
                reader.readAsDataURL((files[0]));
            }
            input.click();
    }

    document.getElementById("toggleBannerText").onclick = function(){toggleBannerTitle();}
    function toggleBannerTitle(){
        let status = document.getElementById("toggleBannerText").innerHTML;

        if (status === "Overlay: ON"){
            set(ref(db, 'toggleBannerStatus'), {
                status: "OFF",
            });
            document.getElementById("toggleBannerText").innerHTML = "Overlay: OFF"

        } else {
            set(ref(db, 'toggleBannerStatus'), {
                status: "ON",
            });
            document.getElementById("toggleBannerText").innerHTML = "Overlay: ON"
        }

    }

    document.getElementById("changeText").onclick = function(){changeText();}
    function changeText() {

        let newText = prompt("Please paste the new story text:");
        if (newText == null || newText === "") {
            //closed
        } else {
            set(ref(db, 'titleText'), {
                titleTextContent: newText,
            });
        }
    }

    document.getElementById("changeYouTubeURL").onclick = function(){changeYouTubeURL();}
    function changeYouTubeURL() {

        let newURL = prompt("Please enter the new YouTube URL-ID (the letters after 'watch?v=')");
        if (newURL == null || newURL === "") {
            //closed
        } else {
            set(ref(db, 'youtubeURL'), {
                youtubeURLContent: newURL,
            });
        }
    }

    //<--------------------------------------------------------- LOGIN/LOGOUT ---------------------------------------------------------------------------------------->

    document.getElementById("adminLogin").onclick = function(){getEmailAndPassword();}
    function getEmailAndPassword() {
        let email = prompt("Please enter your email address:");
        if (email == null || email === "") {
            //closed
        } else {
            let password = prompt("Please enter your password:");
            if (password == null || password === "") {
                //closed
            } else {
                logIn(email, password);
            }
        }
    }

    function logIn(email, password){
        const auth = getAuth();
        signInWithEmailAndPassword(auth, email, password)
            .then((userInfo) => {
                alert("Successfully logged in");
                document.getElementById("adminContainer").style.display = "block";
            })
            .catch((error) => {
                const errorMessage = error.message;
                alert(errorMessage);
                document.getElementById("adminContainer").style.display = "none";
            });
    }

    document.getElementById("logOutButton").onclick = function(){logOut();}
    function logOut(){

        const auth = getAuth();
        signOut(auth).then(() => {
            alert("Successfully logged out")
        }).catch((error) => {
            alert(error);
        });
    }

    //<--------------------------------------------------------------- TBA ------------------------------------------------------------------------------------------>

    //const email = "admin@outlook.com"
    //const password = "123Password123";

    /*
        function checkIfLoggedIn(){
            console.log("Checking for users")

            const auth = getAuth();
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    console.log("Update: You are logged in!");
                } else {
                    console.log("Update: You are not logged in!");
                }
            });
        }*/

    /*    function createUser() {
            console.log("User creation activated!");

            const auth = getAuth();
            createUserWithEmailAndPassword(auth, email, password)
                .then((userInfo) => {
                    console.log("User created!")
                })
                .catch((error) => {
                    const errorMessage = error.message;
                    console.log(errorMessage);
                });
        }*/

</script>

</body>
</html>