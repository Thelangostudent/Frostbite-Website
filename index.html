<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1">

    <title>Frostbite</title>
    <link rel="stylesheet" href="Styling/MainStyle.css" type="text/css" />
    <script src="Scripts/MainScript.js"></script>
    <script src="Scripts/ScrollFade.js"></script>
    <title></title>
</head>
<body>

<!---------------------------------------------------------------- ADMIN MENU -------------------------------------------------------------------------------------------->

<div id="adminContainer">

    <h3 id="adminTitle">Admin menu</h3>

    <div class="alignInMiddle">
    <button id="changeBackgroundImage">Change Image</button>
    </div>

    <div class="alignInMiddle">
        <button id="changeText">Change Text</button>
    </div>

    <div class="alignInMiddle">
        <button id= "addAlbumCover"> Add Album Cover</button>
    </div>

    <div class="alignInMiddle">
    <button id="logOutButton">Log Out</button>
    </div>

</div>

<!------------------------------------------------------------------- NAVBAR --------------------------------------------------------------------------------------------->

<div class="navigation-bar">
    <a id="logoFloat" href="index.html" class="navMenuSelectable"><img src="Pictures/frostbiteLogo.jpg" id="logo" draggable="false" alt="logo"></a>
    <h3><a id="logoText" href="index.html"> FROSTBITE </a></h3>

    <div id="backgroundSquare"></div>

    <a href="https://www.youtube.com" class="navMenuSelectable"><img  id="youtubeLogo" src="Pictures/YoutubeInverted.png" draggable="false" alt="YouTube"></a>
    <a href="https://www.instagram.com" class="navMenuSelectable"><img  id="instagramLogo" src="Pictures/InstagramInverted.png" draggable="false" alt="Instagram"></a>
    <a href="https://www.facebook.com" class="navMenuSelectable"><img id="facebookLogo" src="Pictures/FacebookInverted.png" draggable="false" alt="FaceBook"></a>

    <a href="tickets.html" style="margin-right: 1vw;" class="navMenuSelectable">TICKETS</a>
    <a href="#aboutTitle" class="navMenuSelectable">ABOUT</a>
    <a href="video.html" class="navMenuSelectable">VIDEO</a>
    <a href="music.html" class="navMenuSelectable">MUSIC</a>
    <a href="index.html" class="navMenuSelectable">HOME</a>
</div>

<!--------------------------------------------------------------- MAIN CONTAINER ----------------------------------------------------------------------------------------->

<div id="mainContent" style="display: block">

    <div id="banner">
        <img id="frostbiteBackground" src="Pictures/bannerPlaceholder.png" height=100% width=100% draggable="false" alt="Frostbite Background" class="largePictureDisplay"/>

        <div id="bannerText">
            <h3 id="frostbiteBannerNameBackground">FROSTBITE</h3>
            <h3 id="frostbiteBannerName">FROSTBITE</h3>
        </div>
    </div>

    <div id="albumCovers">
        <div id="gridContainer">
            <div class="coverGridItem">
                <img id="testCover" src="Pictures/testCover.png" alt="testCover" height="10%" width="10%" />


            </div>
        </div>
    </div>

    <div id="aboutContainer">
        <h3 id="aboutTitle">FROSTBITE: The Story</h3>

        <div class="item scrollFade">
            <a id="aboutText"></a>
            <a id="aboutTextEnd" style="margin-top: 0.6vw; margin-bottom: 2vw">For more information please get in touch.</a>
        </div>

    </div>
</div>
    <!--------------------------------------------------------------- FOOTER --------------------------------------------------------------------------------------------->

<div class="item scrollFade">
    <footer id="footer">
        <h3 class="footerText">© Copyright 2022 Frostbite. All rights reserved.</h3>
        <h3 class="footerText"><a id="emailLink" href="mailto:post@frostbiteband.com">post@frostbiteband.com</a></h3>
        <div id="adminLogin"><h3 class="footerText">admin login</h3></div>
    </footer>
</div>

<script type="module">

    //<----------------------------------------------------- DATABASE CONFIGURATION ------------------------------------------------------------------------------------->

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-database.js";
    import { createUserWithEmailAndPassword, getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut} from 'https://www.gstatic.com/firebasejs/9.6.6/firebase-auth.js';
    import { getStorage, ref as refStorage, uploadBytes, getDownloadURL} from 'https://www.gstatic.com/firebasejs/9.6.6/firebase-storage.js';

    const firebaseConfig = {
        apiKey: "AIzaSyDdmHsJu_s8rE1dkcB3oLyyTLJQOI1ZVAg",
        authDomain: "frostbite-backend.firebaseapp.com",
        projectId: "frostbite-backend",
        storageBucket: "frostbite-backend.appspot.com",
        messagingSenderId: "388567472682",
        appId: "1:388567472682:web:893bbf2a74fe78bc4e8153",
        measurementId: "G-CMP5CEZ81E",
        databaseURL: "https://frostbite-backend-default-rtdb.europe-west1.firebasedatabase.app"
    };

    // Initialize Firebase
    const firebase = initializeApp(firebaseConfig);
    const db = getDatabase();
    const storage = getStorage();

    //<--------------------------------------------------------- ONLOAD FUNCTIONS ---------------------------------------------------------------------------------------->

    document.body.onload = function() {getInfoFromServer()};
    function getInfoFromServer(){
        getBannerImage();
        getTitleText();
        getUserStatus();
    }

    //Gets the frostbite text from the server on load
    function getTitleText(){
        const userStatus = ref(db, 'titleText/titleTextContent');
        onValue(userStatus, (snapshot) => {
            document.getElementById("aboutText").innerHTML = snapshot.val();
        });
    }

    //gets the user status (logged in/logged out) and displays the admin menu accordingly
    function getUserStatus(){
        const auth = getAuth();
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("Update: You are logged in!");
                document.getElementById("adminContainer").style.display = "block";

            } else {
                console.log("Update: You are not logged in!");
                document.getElementById("adminContainer").style.display = "none";
            }
        });
    }

    function getBannerImage(){
        getDownloadURL(refStorage(storage, 'bannerImage'))
            .then((url) => {
                document.getElementById("frostbiteBackground").src = url;
                console.log("Image updated!")
            })
    }

    //<--------------------------------------------------------- ADMIN FUNCTIONS ---------------------------------------------------------------------------------------->

    document.getElementById("changeBackgroundImage").onclick = function(e){changeBackgroundImage();}
    function changeBackgroundImage(){

        let files = [];
        let reader;

        const input = document.createElement('input');
        input.type = 'file';
        input.accept = "image/png, image/jpg, image/jpeg, image/gif";

        input.onchange = e => {
            files = e.target.files;
            reader = new FileReader();
            reader.onload = function (){

                const storage = getStorage();
                const imagesRef = refStorage(storage, 'bannerImage');

                //uploads the new image to firebase
                uploadBytes(imagesRef, files[0]).then((snapshot) => {

                    //gets the new image from firebase and updates the banner
                    getDownloadURL(refStorage(storage, 'bannerImage'))
                        .then((url) => {
                            document.getElementById("frostbiteBackground").src = url;
                            console.log("Image updated!")
                        })

                });
            }
            reader.readAsDataURL((files[0]));
        }
        input.click();
    }

    document.getElementById("changeText").onclick = function(){changeText();}
    function changeText() {

        let newText = prompt("Please paste the new text:");
        if (newText == null || newText === "") {
            //closed
        } else {
            set(ref(db, 'titleText'), {
                titleTextContent: newText,
            });
        }
    }

    document.getElementById("adminLogin").onclick = function(){getEmailAndPassword();}
    function getEmailAndPassword() {
        let email = prompt("Please enter your email address:");
        if (email == null || email === "") {
            //closed
        } else {
            let password = prompt("Please enter your password:");
            if (password == null || password === "") {
                //closed
            } else {
                logIn(email, password);
            }
        }
    }

    function logIn(email, password){
        const auth = getAuth();
        signInWithEmailAndPassword(auth, email, password)
            .then((userInfo) => {
                alert("Successfully logged in");
                document.getElementById("adminContainer").style.display = "block";
            })
            .catch((error) => {
                const errorMessage = error.message;
                alert(errorMessage);
                document.getElementById("adminContainer").style.display = "none";
            });
    }

    document.getElementById("logOutButton").onclick = function(){logOut();}
    function logOut(){
        console.log("Logout activated");

        const auth = getAuth();
        signOut(auth).then(() => {
            console.log("User is logged out")
        }).catch((error) => {
            console.log("Logout failed")
            console.log(error);
        });
    }

    //<--------------------------------------------------------------- TBA ------------------------------------------------------------------------------------------>


    //const email = "admin@outlook.com"
    //const password = "123Password123";

    /*
        function checkIfLoggedIn(){
            console.log("Checking for users")

            const auth = getAuth();
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    console.log("Update: You are logged in!");
                } else {
                    console.log("Update: You are not logged in!");
                }
            });
        }*/

    /*    function createUser() {
            console.log("User creation activated!");

            const auth = getAuth();
            createUserWithEmailAndPassword(auth, email, password)
                .then((userInfo) => {
                    console.log("User created!")
                })
                .catch((error) => {
                    const errorMessage = error.message;
                    console.log(errorMessage);
                });
        }*/

</script>

</body>
</html>